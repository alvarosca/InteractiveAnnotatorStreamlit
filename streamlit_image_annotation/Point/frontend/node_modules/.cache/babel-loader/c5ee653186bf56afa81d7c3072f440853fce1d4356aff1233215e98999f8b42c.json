{"ast":null,"code":"import _slicedToArray from\"/home/DigPatho/InteractiveAnnotatorStreamlitV5/streamlit_image_annotation/Point/frontend/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import{Streamlit,withStreamlitConnection}from\"streamlit-component-lib\";import React,{useEffect,useState}from\"react\";import{ChakraProvider,Box,Spacer,HStack,Center}from'@chakra-ui/react';import useImage from'use-image';import ThemeSwitcher from'./ThemeSwitcher';import PointCanvas from\"./PointCanvas\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var PointDet=function PointDet(_ref){var args=_ref.args,theme=_ref.theme;var image_url=args.image_url,image_size=args.image_size,label_list=args.label_list,points_info=args.points_info,color_map=args.color_map,point_width=args.point_width,use_space=args.use_space,mode=args.mode,label=args.label,scale_=args.scale_;var params=new URLSearchParams(window.location.search);var baseUrl=params.get('streamlitUrl');var _useImage=useImage(baseUrl+image_url),_useImage2=_slicedToArray(_useImage,1),image=_useImage2[0];var _React$useState=React.useState(points_info.map(function(p,i){return{x:p.point[0],y:p.point[1],label:p.label,stroke:color_map[p.label],id:'point-'+i};})),_React$useState2=_slicedToArray(_React$useState,2),pointsInfo=_React$useState2[0],setPointsInfo=_React$useState2[1];var _React$useState3=React.useState(null),_React$useState4=_slicedToArray(_React$useState3,2),selectedId=_React$useState4[0],setSelectedId=_React$useState4[1];var _useState=useState(1.0),_useState2=_slicedToArray(_useState,2),scale=_useState2[0],setScale=_useState2[1];useEffect(function(){var resizeCanvas=function resizeCanvas(){var scale_ratio=window.innerWidth/image_size[0];setScale(Math.min(scale_ratio,1.0)*(scale_!==null&&scale_!==void 0?scale_:1));// Use scale_ safely\nStreamlit.setFrameHeight(image_size[1]*Math.min(scale_ratio,1.0));};window.addEventListener('resize',resizeCanvas);resizeCanvas();},[image_size,scale_]);// Added scale_ as a dependency\nuseEffect(function(){var handleKeyPress=function handleKeyPress(event){if(use_space&&event.key===' '){var currentPointsValue=pointsInfo.map(function(point,i){return{point:[point.x,point.y],label_id:label_list.indexOf(point.label),label:point.label};});Streamlit.setComponentValue(currentPointsValue);}};window.addEventListener('keydown',handleKeyPress);return function(){window.removeEventListener('keydown',handleKeyPress);};},[pointsInfo]);// This effect runs only when pointsInfo changes\nuseEffect(function(){// Only set the component value when pointsInfo changes\nvar currentPointsValue=pointsInfo.map(function(point,i){return{point:[point.x,point.y],label_id:label_list.indexOf(point.label),label:point.label};});Streamlit.setComponentValue(currentPointsValue);},[pointsInfo]);// Triggered when pointsInfo changes\nreturn/*#__PURE__*/_jsx(ChakraProvider,{children:/*#__PURE__*/_jsx(ThemeSwitcher,{theme:theme,children:/*#__PURE__*/_jsx(Center,{children:/*#__PURE__*/_jsxs(HStack,{children:[/*#__PURE__*/_jsx(Box,{width:\"100%\",style:{overflow:'auto',// Enable scrollbars if content overflows\nmaxWidth:'100%',// Ensure the box doesn't exceed its parent width\nheight:'100vh',// Adjust the height for full viewport usage\nposition:'relative'// To ensure scrolling works within the Box container\n},children:/*#__PURE__*/_jsx(PointCanvas,{pointsInfo:pointsInfo,mode:mode// <-- Use the mode directly from args\n,selectedId:selectedId,scale:scale*3,setSelectedId:setSelectedId,setPointsInfo:setPointsInfo,setLabel:function setLabel(){},color_map:color_map,label:label// <-- Use the label directly from args\n,image:image,image_size:image_size,strokeWidth:point_width})}),/*#__PURE__*/_jsx(Spacer,{})]})})})});};export default withStreamlitConnection(PointDet);","map":{"version":3,"names":["Streamlit","withStreamlitConnection","React","useEffect","useState","ChakraProvider","Box","Spacer","HStack","Center","useImage","ThemeSwitcher","PointCanvas","jsx","_jsx","jsxs","_jsxs","PointDet","_ref","args","theme","image_url","image_size","label_list","points_info","color_map","point_width","use_space","mode","label","scale_","params","URLSearchParams","window","location","search","baseUrl","get","_useImage","_useImage2","_slicedToArray","image","_React$useState","map","p","i","x","point","y","stroke","id","_React$useState2","pointsInfo","setPointsInfo","_React$useState3","_React$useState4","selectedId","setSelectedId","_useState","_useState2","scale","setScale","resizeCanvas","scale_ratio","innerWidth","Math","min","setFrameHeight","addEventListener","handleKeyPress","event","key","currentPointsValue","label_id","indexOf","setComponentValue","removeEventListener","children","width","style","overflow","maxWidth","height","position","setLabel","strokeWidth"],"sources":["/home/DigPatho/InteractiveAnnotatorStreamlitV5/streamlit_image_annotation/Point/frontend/src/PointDet.tsx"],"sourcesContent":["import {\n  Streamlit,\n  withStreamlitConnection,\n  ComponentProps\n} from \"streamlit-component-lib\"\nimport React, { useEffect, useState } from \"react\"\nimport { ChakraProvider, Box, Spacer, HStack, Center } from '@chakra-ui/react'\n\nimport useImage from 'use-image';\nimport ThemeSwitcher from './ThemeSwitcher'\nimport PointCanvas from \"./PointCanvas\";\n\nexport interface PythonArgs {\n  image_url: string,\n  image_size: number[],\n  label_list: string[],\n  points_info: any[],\n  color_map: any,\n  point_width: number,\n  use_space: boolean,\n  mode: string,   // <-- Added \"mode\" to the Python arguments\n  label: string,  // <-- Added \"label\" to the Python arguments\n  scale_: number\n}\n\nconst PointDet = ({ args, theme }: ComponentProps) => {\n  const {\n    image_url,\n    image_size,\n    label_list,\n    points_info,\n    color_map,\n    point_width,\n    use_space,\n    mode,  // <-- Extract \"mode\" from the args\n    label,  // <-- Extract \"label\" from the args\n    scale_\n  }: PythonArgs = args\n\n  const params = new URLSearchParams(window.location.search);\n  const baseUrl = params.get('streamlitUrl')\n  const [image] = useImage(baseUrl + image_url)\n  const [pointsInfo, setPointsInfo] = React.useState(\n    points_info.map((p, i) => {\n      return {\n        x: p.point[0],\n        y: p.point[1],\n        label: p.label,\n        stroke: color_map[p.label],\n        id: 'point-' + i\n      }\n    })\n  );\n\n  const [selectedId, setSelectedId] = React.useState<string | null>(null);\n\n  const [scale, setScale] = useState(1.0)\n  useEffect(() => {\n    const resizeCanvas = () => {\n      const scale_ratio = window.innerWidth / image_size[0]\n      setScale(Math.min(scale_ratio, 1.0) * (scale_ ?? 1))  // Use scale_ safely\n      Streamlit.setFrameHeight(image_size[1] * Math.min(scale_ratio, 1.0))\n    }\n    window.addEventListener('resize', resizeCanvas);\n    resizeCanvas()\n  }, [image_size, scale_]) // Added scale_ as a dependency\n\n  useEffect(() => {\n    const handleKeyPress = (event: KeyboardEvent) => {\n      if (use_space && event.key === ' ') { \n        const currentPointsValue = pointsInfo.map((point, i) => {\n          return {\n            point: [point.x, point.y],\n            label_id: label_list.indexOf(point.label),\n            label: point.label\n          }\n        })\n        Streamlit.setComponentValue(currentPointsValue)\n      }\n    };\n    window.addEventListener('keydown', handleKeyPress);\n    return () => {\n      window.removeEventListener('keydown', handleKeyPress);\n    };\n  }, [pointsInfo]); \n\n  // This effect runs only when pointsInfo changes\n  useEffect(() => {\n    // Only set the component value when pointsInfo changes\n    const currentPointsValue = pointsInfo.map((point, i) => {\n      return {\n        point: [point.x, point.y],\n        label_id: label_list.indexOf(point.label),\n        label: point.label\n      }\n    })\n    Streamlit.setComponentValue(currentPointsValue)\n  }, [pointsInfo]); // Triggered when pointsInfo changes\n\n  return (\n    <ChakraProvider>\n      <ThemeSwitcher theme={theme}>\n        <Center>\n          <HStack>\n            <Box \n              width=\"100%\" \n              style={{\n                overflow: 'auto',  // Enable scrollbars if content overflows\n                maxWidth: '100%',  // Ensure the box doesn't exceed its parent width\n                height: '100vh',    // Adjust the height for full viewport usage\n                position: 'relative' // To ensure scrolling works within the Box container\n              }}\n            >\n              <PointCanvas\n                pointsInfo={pointsInfo}\n                mode={mode}  // <-- Use the mode directly from args\n                selectedId={selectedId}\n                scale={scale*3}\n                setSelectedId={setSelectedId}\n                setPointsInfo={setPointsInfo}\n                setLabel={() => {}}\n                color_map={color_map}\n                label={label}  // <-- Use the label directly from args\n                image={image}\n                image_size={image_size}\n                strokeWidth={point_width}\n              />\n            </Box>\n            <Spacer />\n          </HStack>\n        </Center>\n      </ThemeSwitcher>\n    </ChakraProvider>\n  )\n}\n\nexport default withStreamlitConnection(PointDet)"],"mappings":"8KAAA,OACEA,SAAS,CACTC,uBAAuB,KAElB,yBAAyB,CAChC,MAAO,CAAAC,KAAK,EAAIC,SAAS,CAAEC,QAAQ,KAAQ,OAAO,CAClD,OAASC,cAAc,CAAEC,GAAG,CAAEC,MAAM,CAAEC,MAAM,CAAEC,MAAM,KAAQ,kBAAkB,CAE9E,MAAO,CAAAC,QAAQ,KAAM,WAAW,CAChC,MAAO,CAAAC,aAAa,KAAM,iBAAiB,CAC3C,MAAO,CAAAC,WAAW,KAAM,eAAe,CAAC,OAAAC,GAAA,IAAAC,IAAA,gCAAAC,IAAA,IAAAC,KAAA,yBAexC,GAAM,CAAAC,QAAQ,CAAG,QAAX,CAAAA,QAAQA,CAAAC,IAAA,CAAwC,IAAlC,CAAAC,IAAI,CAAAD,IAAA,CAAJC,IAAI,CAAEC,KAAK,CAAAF,IAAA,CAALE,KAAK,CAC7B,GACE,CAAAC,SAAS,CAUKF,IAAI,CAVlBE,SAAS,CACTC,UAAU,CASIH,IAAI,CATlBG,UAAU,CACVC,UAAU,CAQIJ,IAAI,CARlBI,UAAU,CACVC,WAAW,CAOGL,IAAI,CAPlBK,WAAW,CACXC,SAAS,CAMKN,IAAI,CANlBM,SAAS,CACTC,WAAW,CAKGP,IAAI,CALlBO,WAAW,CACXC,SAAS,CAIKR,IAAI,CAJlBQ,SAAS,CACTC,IAAI,CAGUT,IAAI,CAHlBS,IAAI,CACJC,KAAK,CAESV,IAAI,CAFlBU,KAAK,CACLC,MAAM,CACQX,IAAI,CADlBW,MAAM,CAGR,GAAM,CAAAC,MAAM,CAAG,GAAI,CAAAC,eAAe,CAACC,MAAM,CAACC,QAAQ,CAACC,MAAM,CAAC,CAC1D,GAAM,CAAAC,OAAO,CAAGL,MAAM,CAACM,GAAG,CAAC,cAAc,CAAC,CAC1C,IAAAC,SAAA,CAAgB5B,QAAQ,CAAC0B,OAAO,CAAGf,SAAS,CAAC,CAAAkB,UAAA,CAAAC,cAAA,CAAAF,SAAA,IAAtCG,KAAK,CAAAF,UAAA,IACZ,IAAAG,eAAA,CAAoCxC,KAAK,CAACE,QAAQ,CAChDoB,WAAW,CAACmB,GAAG,CAAC,SAACC,CAAC,CAAEC,CAAC,CAAK,CACxB,MAAO,CACLC,CAAC,CAAEF,CAAC,CAACG,KAAK,CAAC,CAAC,CAAC,CACbC,CAAC,CAAEJ,CAAC,CAACG,KAAK,CAAC,CAAC,CAAC,CACblB,KAAK,CAAEe,CAAC,CAACf,KAAK,CACdoB,MAAM,CAAExB,SAAS,CAACmB,CAAC,CAACf,KAAK,CAAC,CAC1BqB,EAAE,CAAE,QAAQ,CAAGL,CACjB,CAAC,CACH,CAAC,CACH,CAAC,CAAAM,gBAAA,CAAAX,cAAA,CAAAE,eAAA,IAVMU,UAAU,CAAAD,gBAAA,IAAEE,aAAa,CAAAF,gBAAA,IAYhC,IAAAG,gBAAA,CAAoCpD,KAAK,CAACE,QAAQ,CAAgB,IAAI,CAAC,CAAAmD,gBAAA,CAAAf,cAAA,CAAAc,gBAAA,IAAhEE,UAAU,CAAAD,gBAAA,IAAEE,aAAa,CAAAF,gBAAA,IAEhC,IAAAG,SAAA,CAA0BtD,QAAQ,CAAC,GAAG,CAAC,CAAAuD,UAAA,CAAAnB,cAAA,CAAAkB,SAAA,IAAhCE,KAAK,CAAAD,UAAA,IAAEE,QAAQ,CAAAF,UAAA,IACtBxD,SAAS,CAAC,UAAM,CACd,GAAM,CAAA2D,YAAY,CAAG,QAAf,CAAAA,YAAYA,CAAA,CAAS,CACzB,GAAM,CAAAC,WAAW,CAAG9B,MAAM,CAAC+B,UAAU,CAAG1C,UAAU,CAAC,CAAC,CAAC,CACrDuC,QAAQ,CAACI,IAAI,CAACC,GAAG,CAACH,WAAW,CAAE,GAAG,CAAC,EAAIjC,MAAM,SAANA,MAAM,UAANA,MAAM,CAAI,CAAC,CAAC,CAAC,CAAE;AACtD9B,SAAS,CAACmE,cAAc,CAAC7C,UAAU,CAAC,CAAC,CAAC,CAAG2C,IAAI,CAACC,GAAG,CAACH,WAAW,CAAE,GAAG,CAAC,CAAC,CACtE,CAAC,CACD9B,MAAM,CAACmC,gBAAgB,CAAC,QAAQ,CAAEN,YAAY,CAAC,CAC/CA,YAAY,CAAC,CAAC,CAChB,CAAC,CAAE,CAACxC,UAAU,CAAEQ,MAAM,CAAC,CAAC,CAAC;AAEzB3B,SAAS,CAAC,UAAM,CACd,GAAM,CAAAkE,cAAc,CAAG,QAAjB,CAAAA,cAAcA,CAAIC,KAAoB,CAAK,CAC/C,GAAI3C,SAAS,EAAI2C,KAAK,CAACC,GAAG,GAAK,GAAG,CAAE,CAClC,GAAM,CAAAC,kBAAkB,CAAGpB,UAAU,CAACT,GAAG,CAAC,SAACI,KAAK,CAAEF,CAAC,CAAK,CACtD,MAAO,CACLE,KAAK,CAAE,CAACA,KAAK,CAACD,CAAC,CAAEC,KAAK,CAACC,CAAC,CAAC,CACzByB,QAAQ,CAAElD,UAAU,CAACmD,OAAO,CAAC3B,KAAK,CAAClB,KAAK,CAAC,CACzCA,KAAK,CAAEkB,KAAK,CAAClB,KACf,CAAC,CACH,CAAC,CAAC,CACF7B,SAAS,CAAC2E,iBAAiB,CAACH,kBAAkB,CAAC,CACjD,CACF,CAAC,CACDvC,MAAM,CAACmC,gBAAgB,CAAC,SAAS,CAAEC,cAAc,CAAC,CAClD,MAAO,WAAM,CACXpC,MAAM,CAAC2C,mBAAmB,CAAC,SAAS,CAAEP,cAAc,CAAC,CACvD,CAAC,CACH,CAAC,CAAE,CAACjB,UAAU,CAAC,CAAC,CAEhB;AACAjD,SAAS,CAAC,UAAM,CACd;AACA,GAAM,CAAAqE,kBAAkB,CAAGpB,UAAU,CAACT,GAAG,CAAC,SAACI,KAAK,CAAEF,CAAC,CAAK,CACtD,MAAO,CACLE,KAAK,CAAE,CAACA,KAAK,CAACD,CAAC,CAAEC,KAAK,CAACC,CAAC,CAAC,CACzByB,QAAQ,CAAElD,UAAU,CAACmD,OAAO,CAAC3B,KAAK,CAAClB,KAAK,CAAC,CACzCA,KAAK,CAAEkB,KAAK,CAAClB,KACf,CAAC,CACH,CAAC,CAAC,CACF7B,SAAS,CAAC2E,iBAAiB,CAACH,kBAAkB,CAAC,CACjD,CAAC,CAAE,CAACpB,UAAU,CAAC,CAAC,CAAE;AAElB,mBACEtC,IAAA,CAACT,cAAc,EAAAwE,QAAA,cACb/D,IAAA,CAACH,aAAa,EAACS,KAAK,CAAEA,KAAM,CAAAyD,QAAA,cAC1B/D,IAAA,CAACL,MAAM,EAAAoE,QAAA,cACL7D,KAAA,CAACR,MAAM,EAAAqE,QAAA,eACL/D,IAAA,CAACR,GAAG,EACFwE,KAAK,CAAC,MAAM,CACZC,KAAK,CAAE,CACLC,QAAQ,CAAE,MAAM,CAAG;AACnBC,QAAQ,CAAE,MAAM,CAAG;AACnBC,MAAM,CAAE,OAAO,CAAK;AACpBC,QAAQ,CAAE,UAAW;AACvB,CAAE,CAAAN,QAAA,cAEF/D,IAAA,CAACF,WAAW,EACVwC,UAAU,CAAEA,UAAW,CACvBxB,IAAI,CAAEA,IAAO;AAAA,CACb4B,UAAU,CAAEA,UAAW,CACvBI,KAAK,CAAEA,KAAK,CAAC,CAAE,CACfH,aAAa,CAAEA,aAAc,CAC7BJ,aAAa,CAAEA,aAAc,CAC7B+B,QAAQ,CAAE,SAAAA,SAAA,CAAM,CAAC,CAAE,CACnB3D,SAAS,CAAEA,SAAU,CACrBI,KAAK,CAAEA,KAAQ;AAAA,CACfY,KAAK,CAAEA,KAAM,CACbnB,UAAU,CAAEA,UAAW,CACvB+D,WAAW,CAAE3D,WAAY,CAC1B,CAAC,CACC,CAAC,cACNZ,IAAA,CAACP,MAAM,GAAE,CAAC,EACJ,CAAC,CACH,CAAC,CACI,CAAC,CACF,CAAC,CAErB,CAAC,CAED,cAAe,CAAAN,uBAAuB,CAACgB,QAAQ,CAAC"},"metadata":{},"sourceType":"module","externalDependencies":[]}