{"ast":null,"code":"import React,{useEffect}from\"react\";import{Layer,Stage,Image}from'react-konva';import Point from'./Point';import Konva from'konva';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var PointCanvas=function PointCanvas(props){var pointsInfo=props.pointsInfo,mode=props.mode,selectedId=props.selectedId,setSelectedId=props.setSelectedId,setPointsInfo=props.setPointsInfo,setLabel=props.setLabel,color_map=props.color_map,scale=props.scale,label=props.label,image_size=props.image_size,image=props.image,strokeWidth=props.strokeWidth;var checkDeselect=function checkDeselect(e){if(!(e.target instanceof Konva.Circle)){if(selectedId===null){if(mode==='Transform'){var pointer=e.target.getStage().getPointerPosition();var points=pointsInfo.slice();var new_id=Date.now().toString();points.push({x:pointer.x/scale,y:pointer.y/scale,label:label,stroke:color_map[label],id:new_id});setPointsInfo(points);setSelectedId(new_id);}}else{setSelectedId(null);}}};useEffect(function(){var points=pointsInfo.slice();for(var i=0;i<points.length;i++){if(points[i].x<0||points[i].y<0){points[i].x=Math.max(0,points[i].x);points[i].y=Math.max(0,points[i].y);setPointsInfo(points);}if(points[i].x>image_size[0]||points[i].y>image_size[1]){points[i].x=Math.min(points[i].x,image_size[0]);points[i].y=Math.min(points[i].y,image_size[1]);setPointsInfo(points);}}},[pointsInfo,image_size]);return/*#__PURE__*/_jsx(\"div\",{style:{width:'100%',height:'100%',overflow:'auto',// Enable scrolling\nposition:'relative',border:'1px solid black'// Optional: makes it clear where the scrollable area is\n},children:/*#__PURE__*/_jsx(\"div\",{style:{width:image_size[0]*scale+'px',height:image_size[1]*scale+'px',position:'relative'},children:/*#__PURE__*/_jsxs(Stage,{width:image_size[0]*scale,height:image_size[1]*scale,onMouseDown:checkDeselect,style:{position:'absolute',top:0,left:0}// Ensures it respects parent div's scroll\n,children:[/*#__PURE__*/_jsx(Layer,{children:/*#__PURE__*/_jsx(Image,{image:image,scaleX:scale,scaleY:scale})}),/*#__PURE__*/_jsx(Layer,{children:pointsInfo.map(function(point,i){return/*#__PURE__*/_jsx(Point,{rectProps:point,scale:scale,strokeWidth:strokeWidth,isSelected:mode==='Transform'&&point.id===selectedId,onClick:function onClick(){if(mode==='Transform'){setSelectedId(point.id);var points=pointsInfo.slice();var lastIndex=points.length-1;var lastItem=points[lastIndex];points[lastIndex]=points[i];points[i]=lastItem;setPointsInfo(points);setLabel(point.label);}else if(mode==='Del'){var _points=pointsInfo.slice();setPointsInfo(_points.filter(function(element){return element.id!==point.id;}));}},onChange:function onChange(newAttrs){var points=pointsInfo.slice();points[i]=newAttrs;setPointsInfo(points);}},i);})})]})})});};export default PointCanvas;","map":{"version":3,"names":["React","useEffect","Layer","Stage","Image","Point","Konva","jsx","_jsx","jsxs","_jsxs","PointCanvas","props","pointsInfo","mode","selectedId","setSelectedId","setPointsInfo","setLabel","color_map","scale","label","image_size","image","strokeWidth","checkDeselect","e","target","Circle","pointer","getStage","getPointerPosition","points","slice","new_id","Date","now","toString","push","x","y","stroke","id","i","length","Math","max","min","style","width","height","overflow","position","border","children","onMouseDown","top","left","scaleX","scaleY","map","point","rectProps","isSelected","onClick","lastIndex","lastItem","filter","element","onChange","newAttrs"],"sources":["/home/DigPatho/InteractiveAnnotatorStreamlitV5/streamlit_image_annotation/Point/frontend/src/PointCanvas.tsx"],"sourcesContent":["import React, { useEffect } from \"react\";\nimport { Layer, Stage, Image } from 'react-konva';\nimport Point from './Point';\nimport Konva from 'konva';\n\nexport interface PointCanvasProps {\n  pointsInfo: any[],\n  mode: string,\n  selectedId: string | null,\n  setSelectedId: any,\n  setPointsInfo: any,\n  setLabel: any,\n  color_map: any,\n  scale: number,\n  label: string,\n  image_size: number[],\n  image: any,\n  strokeWidth: number\n}\n\nconst PointCanvas = (props: PointCanvasProps) => {\n  const {\n    pointsInfo,\n    mode,\n    selectedId,\n    setSelectedId,\n    setPointsInfo,\n    setLabel,\n    color_map,\n    scale,\n    label,\n    image_size,\n    image,\n    strokeWidth\n  }: PointCanvasProps = props;\n\n  const checkDeselect = (e: any) => {\n    if (!(e.target instanceof Konva.Circle)) {\n      if (selectedId === null) {\n        if (mode === 'Transform') {\n          const pointer = e.target.getStage().getPointerPosition();\n          const points = pointsInfo.slice();\n          const new_id = Date.now().toString();\n          points.push({\n            x: pointer.x / scale,\n            y: pointer.y / scale,\n            label: label,\n            stroke: color_map[label],\n            id: new_id\n          });\n          setPointsInfo(points);\n          setSelectedId(new_id);\n        }\n      } else {\n        setSelectedId(null);\n      }\n    }\n  };\n\n  useEffect(() => {\n    const points = pointsInfo.slice();\n    for (let i = 0; i < points.length; i++) {\n      if (points[i].x < 0 || points[i].y < 0) {\n        points[i].x = Math.max(0, points[i].x);\n        points[i].y = Math.max(0, points[i].y);\n        setPointsInfo(points);\n      }\n      if (points[i].x > image_size[0] || points[i].y > image_size[1]) {\n        points[i].x = Math.min(points[i].x, image_size[0]);\n        points[i].y = Math.min(points[i].y, image_size[1]);\n        setPointsInfo(points);\n      }\n    }\n  }, [pointsInfo, image_size]);\n\n  return (\n    <div \n      style={{\n        width: '100%',\n        height: '100%',\n        overflow: 'auto',  // Enable scrolling\n        position: 'relative',\n        border: '1px solid black', // Optional: makes it clear where the scrollable area is\n      }}\n    >\n      <div \n        style={{ \n          width: image_size[0] * scale + 'px', \n          height: image_size[1] * scale + 'px', \n          position: 'relative' \n        }}\n      >\n        <Stage \n          width={image_size[0] * scale} \n          height={image_size[1] * scale} \n          onMouseDown={checkDeselect}\n          style={{ position: 'absolute', top: 0, left: 0 }} // Ensures it respects parent div's scroll\n        >\n          <Layer>\n            <Image image={image} scaleX={scale} scaleY={scale} />\n          </Layer>\n          <Layer>\n            {pointsInfo.map((point, i) => {\n              return (\n                <Point\n                  key={i}\n                  rectProps={point}\n                  scale={scale}\n                  strokeWidth={strokeWidth}\n                  isSelected={mode === 'Transform' && point.id === selectedId}\n                  onClick={() => {\n                    if (mode === 'Transform') {\n                      setSelectedId(point.id);\n                      const points = pointsInfo.slice();\n                      const lastIndex = points.length - 1;\n                      const lastItem = points[lastIndex];\n                      points[lastIndex] = points[i];\n                      points[i] = lastItem;\n                      setPointsInfo(points);\n                      setLabel(point.label);\n                    } else if (mode === 'Del') {\n                      const points = pointsInfo.slice();\n                      setPointsInfo(points.filter((element) => element.id !== point.id));\n                    }\n                  }}\n                  onChange={(newAttrs: any) => {\n                    const points = pointsInfo.slice();\n                    points[i] = newAttrs;\n                    setPointsInfo(points);\n                  }}\n                />\n              );\n            })}\n          </Layer>\n        </Stage>\n      </div>\n    </div>\n  );\n};\n\nexport default PointCanvas;"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}